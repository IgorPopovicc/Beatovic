<header class="nav-wrap" [class.nav-hidden]="_hidden()">
  <div class="nav-inner">
    <button class="menu-btn" type="button"
            aria-label="Toggle menu"
            [attr.aria-expanded]="mobileOpen"
            aria-controls="side-menu"
            (click)="toggleMenu()">
      <img ngSrc="assets/images/icons/hamburger-menu.png" alt="Menu" class="menu-icon" height="512" width="512"/>
    </button>

    <div class="brand">
      <img class="brand-logo" ngSrc="assets/images/logo/planets_text.png" alt="logo" height="72" width="232">
    </div>

    <div class="header-actions">
      <div class="search" [class.open]="searchOpen()">
        <input
          #searchInputInline
          type="text"
          class="search-input-inline"
          placeholder="Pretražite ovde"
          (keydown.escape)="closeSearch()"
        />
        <button
          type="button"
          class="search-btn"
          aria-label="Search"
          [attr.aria-expanded]="searchOpen()"
          (click)="toggleSearch()">
          <img ngSrc="assets/images/icons/search.png" alt="" class="menu-icon" width="512" height="512"/>
        </button>
      </div>

      <a routerLink="/cart" class="cart-btn" aria-label="Cart">
        <img ngSrc="assets/images/icons/shopping-bag.png" alt="Cart" class="menu-icon" width="512" height="512"/>

        @if (cartCount() > 0) {
          <span class="cart-badge" aria-label="Broj stavki u korpi">{{ cartCount() }}</span>
        }
      </a>
    </div>

    <div class="search-mobile" [class.open]="searchOpen()">
      <input
        #searchInputMobile
        type="text"
        class="search-input-mobile"
        placeholder="Pretražite ovde"
        (keydown.escape)="closeSearch()"
      />
    </div>
    @if (searchOpen() && isMobile) {
      <div class="search-backdrop" (click)="closeSearch()"></div>
    }
  </div>

  @if (mobileOpen) {
    <div class="backdrop" (click)="closeMenu()"></div>
  }

  <nav id="side-menu" class="mobile-menu" [class.open]="mobileOpen">
    <div class="menu-col main">
      <ul class="menu-list">
        @for (item of menu(); track item.label; let i = $index) {
          @if (!item.children) {
            <li>
              <a class="menu-item" [routerLink]="item.link" (click)="closeMenu()">
                <span class="label">{{ item.label }}</span>
              </a>
            </li>
          } @else {
            <li>
              <button
                class="menu-item has-children"
                type="button"
                (click)="openSub(i)"
                [attr.aria-expanded]="activeParent() === i"
              >
                <span class="label">{{ item.label }}</span>
                <span class="chev">›</span>
              </button>
            </li>
          }
        }
      </ul>

      <div class="menu-footer-logo">
        <img
          ngSrc="assets/images/logo/planets_just_logo.png"
          alt="Planeta logo"
          width="180"
          height="56"
        />
      </div>
    </div>

    <div class="menu-col sub" [class.open]="activeParent() !== null">
      <div class="submenu-header">
        <button class="back-btn" type="button" (click)="closeSub()" aria-label="Back">‹</button>
        <div class="submenu-title">{{ activeTitle() }}</div>
        <div class="spacer"></div>
      </div>

      <ul class="submenu-list">
        @for (child of activeChildren(); track child.label) {
          <li>
            <a [routerLink]="child.link" (click)="closeMenu()">
              <span class="label">{{ child.label }}</span>
            </a>
          </li>
        }
      </ul>

      <div class="menu-footer-logo">
        <img
          ngSrc="assets/images/logo/planets_just_logo.png"
          alt="Planeta logo"
          width="180"
          height="56"
        />
      </div>
    </div>
  </nav>
</header>
